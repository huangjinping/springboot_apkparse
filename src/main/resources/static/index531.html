<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <title>GooglePlay检验2023-05-31</title>
    <script type="text/javascript" src="jquery.min.js"></script>
    <script type="text/javascript" src="utils.js"></script>

    <script>
        (function () {
            document.addEventListener('DOMContentLoaded', function () {
                var html = document.documentElement;
                var windowWidth = html.clientWidth;
                html.style.fontSize = windowWidth / 7.5 + 'px';
                // 等价于html.style.fontSize = windowWidth / 640 * 100 + 'px';
            }, false);
        })();
    </script>
    <style>

        ul li {
            list-style: none;
        }

        .greenText {
            color: green;
        }

        .garyText {
            color: gray;
        }

        .redText {
            color: red;
        }

        .pageCenter {
            background: white;
            font-size: 0.2rem;
        }

        .fileInput {
            display: none;
        }

        .appFileNameView {
            display: none;
        }

        .iffsubmitContainer {
            margin-top: 0.2rem;
        }

        .requestView {
            text-align: center;
        }

        .iffsubmit {
            background: #f40;
            border-radius: 0.3rem;
            padding: 0.1rem 1rem;
            color: white;
        }

        .resultContainer {
            padding: 0.1rem;
            font-size: 0.1rem;

        }

        .resultTitle {
            font-size: 0.2rem;
            color: black;
        }

        .resultlistate {
            margin-left: 0.3rem;
            font-weight: bold;

        }

        .resultUl {

        }

        .resultli {
        }

        .spiritContainer {
            width: 200px;
            height: 40px;
            border: deepskyblue solid 1px;
            border-radius: 10px;
            background-color: deepskyblue;
            color: white;
            position: absolute;
            top: 20px;
            overflow: hidden;
            right: 10px;
            line-height: 40px;
            font-size: 20px;
            text-align: center;
        }

        .spiritContainer:hover {
            background-color: #f40;
            border: #f40 solid 1px;
            height: auto;
            overflow: hidden;

        }

        .spiritContainer a {
            color: white;
        }


        .appAlert {
            border: orange dashed 5px;
            border-radius: 10px;
            background-color: white;
            color: grey;
            font-size: 22px;
        }

        .methodLine {
            border: #808080 solid 1px;
            margin-top: 10px;

        }
    </style>
</head>
<body>
<div class="pageCenter">


    <div>
        <a href="https://support.google.com/googleplay/android-developer/answer/13161491?sjid=10757034145013087121-NA">政策依据</a>
    </div>
    <div class="spiritContainer">
        <span class="spirit">菜单</span>
        <ul class="menuList">
            <!--            <li><a href="/index">apk,aab业务包</a></li>-->
            <!--            <li><a href="/nbjson">检测大json</a></li>-->
            <!--            <li><a href="/debug1">检测占坑包</a></li>-->
        </ul>
    </div>
    <div class="requestView">
        <div>
            <span>点击上传:正式Apk或者aab</span>
        </div>
        <img class="imgClickIt" src="dianji.png">
        <form id="uploadForm" action="/uploadImage" method="POST" enctype="multipart/form-data">
            <input class="fileInput" id="inputFile" type="file" NAME="file">
            <div class="appFileNameView">
                <span>文件名称:</span><span class="appFileName"></span>
            </div>

            <div class="iffsubmitContainer">
            <span class="iffsubmit">
                0531业务包上传
            </span>
            </div>
        </form>
    </div>


    <div class="resultContainer">
        <div class="resultTitle">
            Permission（权限配置）
        </div>
        <div class="appAlert">
            <ul>
                <li>android.permission.READ_CALL_LOG，通话记录权限，请确认这个包是不是需要配置。</li>
            </ul>
        </div>
        <ul class="resultUl permissionUl">
        </ul>

        <div class="resultTitle">
            Application 配置
        </div>
        <ul class="resultUl applicationUl">
            <li class="resultli">
                <span class="resultliname">packageName</span><span
                    class="resultlistate packageName"></span>
            </li>
            <li class="resultli">
                <span class="resultliname">minSdkVersion</span><span class="resultlistate sdkVersion"></span>
            </li>
            <li class="resultli">
                <span class="resultliname">targetSdkVersion</span><span class="resultlistate targetSdkVersion"></span>
            </li>
            <li class="resultli">
                <span class="resultliname">versionCode</span><span class="resultlistate versionCode"></span>
            </li>
            <li class="resultli">
                <span class="resultliname">versionName</span><span class="resultlistate versionName"></span>
            </li>

            <li class="resultli">
                <span class="resultliname">networkSecurityConfig</span><span
                    class="resultlistate networkSecurityConfig"></span>
            </li>
            <!--            <li class="resultli pRequestLegacyExternalStorage">-->
            <!--                <span class="resultliname">requestLegacyExternalStorage</span><span-->
            <!--                    class="resultlistate requestLegacyExternalStorage"></span>-->
            <!--            </li>-->
        </ul>
        <div class="resultTitle">
            Activity 启动
        </div>

        <ul class="resultUl activityUl">
            <li class="resultli">
                <span class="resultliname">launcherName</span><span class="resultlistate launcherName"></span>
            </li>
            <li class="resultli">
                <span class="resultliname">exported</span><span class="resultlistate exported"></span>
            </li>
            <li class="resultli">
                <span class="resultliname">scheme</span><span class="resultlistate scheme"></span>
            </li>
            <li class="resultli">
                <span class="resultliname">appLink</span><span class="resultlistate appLink"></span>
            </li>
        </ul>

        <div class="resultTitle">
            meta-data
        </div>

        <ul class="resultUl metaDataUl">
            <li class="resultli">

                <span class="resultliname">io.branch.sdk.BranchKey</span><span class="resultlistate BranchKey"></span>
            </li>
            <li class="resultli">
                <span class="resultliname">io.branch.sdk.TestMode</span><span class="resultlistate TestMode"></span>
            </li>
            <li class="resultli">
                <span class="resultliname">com.facebook.sdk.ApplicationId</span><span
                    class="resultlistate ApplicationId"></span>
            </li>
            <li class="resultli">
                <span class="resultliname">com.facebook.sdk.AutoLogAppEventsEnabled</span><span
                    class="resultlistate AutoLogAppEventsEnabled"></span>
            </li>
            <li class="resultli">
                <span class="resultliname">com.facebook.sdk.AdvertiserIDCollectionEnabled</span><span
                    class="resultlistate AdvertiserIDCollectionEnabled"></span>
            </li>
            <li class="resultli">
                <span class="resultliname">com.facebook.sdk.ClientToken</span><span
                    class="resultlistate ClientToken"></span>
            </li>
        </ul>

        <div class="resultTitle">
            queries
        </div>


        <ul class="resultUl queriesUl">
        </ul>
        <div class="resultTitle">
            域名检测
        </div>
        <ul class="domainNameUl">
            <!--            <li class="resultli">-->
            <!--                <span class="resultliname">scheme</span><span class="resultlistate scheme"></span>-->
            <!--            </li>-->
        </ul>

        <div class="resultTitle">
            库检测
        </div>


        <ul class="keepLibUl">
            <!--            <li class="resultli">-->
            <!--                <span class="resultliname">scheme</span><span class="resultlistate scheme"></span>-->
            <!--            </li>-->
        </ul>

        <div class="resultTitle">
            方法检测
        </div>
        <ul class="methodLibUl">
            <!--            <li class="resultli">-->
            <!--                <span class="resultliname">scheme</span><span class="resultlistate scheme"></span>-->
            <!--            </li>-->
        </ul>

        <div class="resultTitle">
            签名信息
        </div>
        <ul class="fileCertUl">
            <!--            <li class="resultli">-->
            <!--                <span class="resultliname">scheme</span><span class="resultlistate scheme"></span>-->
            <!--            </li>-->
        </ul>
        <div class="resultTitle">
            <div>字符串关联检测 <span class="appAlert" style="padding: 10px">（注意：已提交google单产品业务包的不必考虑此项）</span></div>
        </div>
        <ul class="searchResultUl">
            <!--            <li class="resultli">-->
            <!--                <span class="resultliname">scheme</span><span class="resultlistate scheme"></span>-->
            <!--            </li>-->
        </ul>
        <div class="resultTitle">
            <div>接口字段字符串关联检测 <span class="appAlert" style="padding: 10px">（注意：已提交google单产品业务包的不必考虑此项）</span></div>
        </div>
        <ul class="searchResultFiled">
        </ul>
        <div class="resultTitle">
            <div>接口名称字符串关联检测 <span class="appAlert" style="padding: 10px">（注意：已提交google单产品业务包的不必考虑此项）</span></div>
        </div>
        <ul class="searchResultPath">
        </ul>

    </div>

</div>

<script>
    (function () {
        console.log($);

        init();

        function init() {
            if (window.timerAp) {
                clearInterval(window.timerAp);
                window.timerAp = null;
            }
            window.timerAp = setInterval(function () {
                try {
                    var list = ['solid', 'dashed', "dotted", "double"];
                    var index = Math.floor(Math.random() * list.length);
                    $(".appAlert").css("borderStyle", list[index]);
                } catch (e) {
                }
            }, 1000)

        }


        function hideResult() {
            $(".resultContainer").css("display", 'none');
        }

        function showResult() {
            restResultAllView();
            $(".resultContainer").css("display", 'block');
        }

        hideResult();
        const $file = $('#inputFile');
        console.log($file);
        $file.on("change", function () { // 文件选择事件
            const filename = $file.val();
            console.log(filename);
            $(".appFileNameView").css("display", 'block');
            hideResult();
            $(".appFileName").html(filename);
        });
        restResultAllView();

        function uploadImage() {
            // 校验字段省略
            // 使用 ajax 上传文件，需要用 FormData 对象
            console.log($file[0].files[0]);
            var value = $file[0].files[0];
            if (value) {

            } else {
                showToast("请选择文件")
                return;
            }
            var formData = new FormData();
            formData.append("file", $file[0].files[0]); // 要上传的文件
            formData.append("appType", "2");
            showLoading();
            hideResult();
            $.ajax({
                url: "/uploadImage",
                type: "post",
                data: formData,
                timeout: 1000 * 120,
                contentType: false,
                processData: false,
                dataType: "text",
                success: function (data) {
                    dismissLoading();
                    var res = eval('(' + data + ')');
                    parseResult(res);
                    searchTaskPath(res);
                    searchTaskFiled(res);
                },
                error: function (err) {
                    $(".appFileNameView").css("display", 'none');
                    dismissLoading();
                    console.error(err);
                }
            });
        }

        function searchTaskPath(e) {
            var savePos = e.data.savePos;

            if (isEmpty(savePos)) {
                return;
            }
            var formData = new FormData();
            formData.append("savePos", e.data.savePos);
            $.ajax({
                url: "/searchTaskPath",
                type: "post",
                data: formData,
                timeout: 1000 * 120,
                contentType: false,
                processData: false,
                dataType: "text",
                success: function (data) {
                    console.log(data);
                    var res = eval('(' + data + ')');

                    var dataRes = res.data;
                    var autoHtml = "";
                    dataRes.searchPath.forEach(function (v, i) {

                        var state = "";
                        var stateText = "";
                        if (1 == v.state) {
                            state = "";
                        } else if (-1 == v.state) {
                            stateText = "redText";
                            state = "问题字符";
                        }
                        stateText = "redText";
                        state = "问题字符";
                        autoHtml += "  <li class=\"resultli\">\n" +
                            "                <span class=\"resultliname\">" + v.name + "</span><span class=\"resultlistate " + stateText + "\">" + state + "</span>\n" +
                            "            </li>";
                    });
                    $(".searchResultPath").html(autoHtml);
                },
                error: function (err) {

                    console.error(err);
                }
            });
        }

        function searchTaskFiled(e) {
            var savePos = e.data.savePos;

            if (isEmpty(savePos)) {
                return;
            }
            var formData = new FormData();
            formData.append("savePos", e.data.savePos);
            $.ajax({
                url: "/searchTaskFiled",
                type: "post",
                data: formData,
                timeout: 1000 * 120,
                contentType: false,
                processData: false,
                dataType: "text",
                success: function (data) {
                    var res = eval('(' + data + ')');

                    var dataRes = res.data;
                    var autoHtml = "";
                    dataRes.searchField.forEach(function (v, i) {

                        var state = "";
                        var stateText = "";
                        if (1 == v.state) {
                            state = "";
                        } else if (-1 == v.state) {
                            stateText = "redText";
                            state = "问题字符";
                        }
                        stateText = "redText";
                        state = "问题字符";
                        // stateText = "redText";
                        autoHtml += "  <li class=\"resultli\">\n" +
                            "                <span class=\"resultliname\">" + v.name + "</span><span class=\"resultlistate " + stateText + "\">" + state + "</span>\n" +
                            "            </li>";
                    });
                    $(".searchResultFiled").html(autoHtml);

                },
                error: function (err) {

                    console.error(err);
                }
            });
        }

        function parseResult(res) {
            console.log(res);
            var data = res.data;
            showResult();
            if (data.permission) {
                var autoHtml = "";
                data.permission.forEach(function (v, i) {

                    var state = "";
                    var stateText = "greenText";
                    if (0 == v.state) {
                        state = "缺失";
                        stateText = "redText";
                    } else if (1 == v.state) {
                        stateText = "greenText";

                        state = "已配置";
                    } else if (2 == v.state) {
                        stateText = "garyText";

                        state = "范围外";
                    } else if (3 == v.state) {
                        stateText = "redText";
                        state = "严禁配置";
                    }
                    autoHtml += "  <li class=\"resultli\">\n" +
                        "                <span class=\"resultliname\">" + v.permission + "</span><span class=\"resultlistate " + stateText + "\">" + state + "</span>\n" +
                        "            </li>";
                });

                $(".permissionUl").html(autoHtml);
            }


            if (data.application) {

                var packageName = data.application.packageName;
                $(".packageName").html(packageName);
                $(".sdkVersion").html(data.sdkVersion);
                $(".versionName").html(data.versionName);
                $(".versionCode").html(data.versionCode);


                var sdkVersion = data.sdkVersion;
                if (sdkVersion > 21) {
                    $(".sdkVersion").addClass("redText");
                    $(".sdkVersion").html("当前" + sdkVersion + ",minSdkVersion 兼容5.0及以上所有版本");
                } else {
                    $(".sdkVersion").html(sdkVersion);
                    $(".sdkVersion").removeClass("redText");
                }


                var compileSdkVersion = data.targetSdkVersion;
                if (compileSdkVersion < 33) {
                    $(".targetSdkVersion").addClass("redText");
                    $(".targetSdkVersion").html("当前" + compileSdkVersion + ",google play targetSdk 最少33");
                } else {
                    $(".targetSdkVersion").html(compileSdkVersion);
                    $(".targetSdkVersion").removeClass("redText");
                }

                var networkSecurityConfig = data.application.networkSecurityConfig;
                if (isEmpty(networkSecurityConfig)) {
                    $(".networkSecurityConfig").addClass("redText");
                    $(".networkSecurityConfig").html("没有配置networkSecurityConfig，确认是否本包是否需要http");
                } else {
                    $(".networkSecurityConfig").removeClass("redText");
                    $(".networkSecurityConfig").html(networkSecurityConfig);
                }


                // var requestLegacyExternalStorage = data.application.requestLegacyExternalStorage;
                // $(".requestLegacyExternalStorage").html(requestLegacyExternalStorage);
                // $(".pRequestLegacyExternalStorage").show();
                // if (isEmpty(requestLegacyExternalStorage)) {
                //     $(".pRequestLegacyExternalStorage").hide();
                //     $(".requestLegacyExternalStorage").removeClass("redText");
                // } else {
                //     $(".requestLegacyExternalStorage").addClass("redText");
                //     $(".requestLegacyExternalStorage").html(requestLegacyExternalStorage + ":这个选项去掉");
                // }
            }
            if (data.activity) {
                var launcherName = data.activity.launcherName;
                var appLink = data.activity.appLink;
                var exported = data.activity.exported;
                var activityscheme = data.activity.scheme;

                $(".launcherName").html(launcherName);
                if (appLink) {
                    var host = appLink.host;
                    var scheme = appLink.scheme;

                    if (!isEmpty(host) && !isEmpty(scheme)) {
                        $(".appLink").removeClass("redText");
                        appLink = "host:" + host + "　scheme:" + scheme;
                        $(".appLink").html(appLink);
                    } else {
                        $(".appLink").addClass("redText");
                        $(".appLink").html("缺失");
                    }
                } else {
                    $(".appLink").addClass("redText");
                    $(".appLink").html("缺失");
                }

                if (isEmpty(exported)) {
                    $(".exported").html("缺失");

                    $(".exported").addClass("redText");
                } else {
                    $(".exported").removeClass("redText");
                    $(".exported").html(exported);
                }

                if (activityscheme) {
                    var host = activityscheme.host;
                    var scheme = activityscheme.scheme;
                    if (!isEmpty(host) && !isEmpty(scheme)) {
                        $(".scheme").removeClass("redText");
                        scheme = "host:" + host + "　scheme:" + scheme;
                        $(".scheme").html(scheme);
                    } else if (!isEmpty(scheme)) {
                        $(".scheme").removeClass("redText");
                        scheme = "　scheme:" + scheme;
                        $(".scheme").html(scheme);
                    } else {
                        $(".scheme").addClass("redText");
                        $(".scheme").html("缺失");
                    }
                } else {
                    $(".scheme").addClass("redText");
                    $(".scheme").html("缺失");
                }


            }


            if (data.metaData) {

                var branchKeykey = "io.branch.sdk.BranchKey";
                var TestModekey = "io.branch.sdk.TestMode";
                var ApplicationIdkey = "com.facebook.sdk.ApplicationId";
                var AutoLogAppEventsEnabledkey = "com.facebook.sdk.AutoLogAppEventsEnabled";
                var AdvertiserIDCollectionEnabledkey = "com.facebook.sdk.AdvertiserIDCollectionEnabled";
                var ClientTokenkey = "com.facebook.sdk.ClientToken";
                data.metaData.forEach(function (v, i) {
                    var key = v.name;
                    var value = v.value;
                    if (branchKeykey == key) {
                        $(".BranchKey").html(value);
                        if (!isEmpty(value)) {
                            $(".BranchKey").removeClass("redText");
                        }

                    } else if (TestModekey == key) {
                        $(".TestMode").html(value);
                        if (!isEmpty(value) && "false" == value) {
                            $(".TestMode").removeClass("redText");
                        }
                    } else if (ApplicationIdkey == key) {
                        $(".ApplicationId").html(value);
                        if (!isEmpty(value)) {
                            $(".ApplicationId").removeClass("redText");
                        }
                    } else if (AutoLogAppEventsEnabledkey == key) {
                        $(".AutoLogAppEventsEnabled").html(value);
                        if (!isEmpty(value) && "true" == value) {
                            $(".AutoLogAppEventsEnabled").removeClass("redText");
                        }
                    } else if (AdvertiserIDCollectionEnabledkey == key) {
                        $(".AdvertiserIDCollectionEnabled").html(value);
                        if (!isEmpty(value) && "true" == value) {
                            $(".AdvertiserIDCollectionEnabled").removeClass("redText");
                        }
                    } else if (ClientTokenkey == key) {
                        $(".ClientToken").html(value);
                        if (!isEmpty(value)) {
                            $(".ClientToken").removeClass("redText");
                        }
                    }
                });
            }

            if (data.queries) {
                var autoHtml = "";
                data.queries.forEach(function (v, i) {
                    var state = "";
                    var stateText = "";

                    if (1 == v.state) {
                        state = "已配置";
                    } else {
                        stateText = "redText";
                        state = "缺失";
                    }
                    autoHtml += "  <li class=\"resultli\">\n" +
                        "                <span class=\"resultliname\">" + v.actionName + "</span><span class=\"resultlistate " + stateText + "\">" + state + "</span>\n" +
                        "            </li>";
                });

                $(".queriesUl").html(autoHtml);
            }


            if (data.keepPackage) {
                var autoHtml = "";
                data.keepPackage.forEach(function (v, i) {

                    var state = "";
                    var stateText = "";

                    if (1 == v.state) {
                        state = "已配置";
                    } else if (-1 == v.state) {
                        stateText = "redText";
                        state = "建议删除";
                    } else {
                        stateText = "redText";
                        state = "缺失";
                    }

                    if (v.name == "com/google/firebase/crashlytics") {
                        if (isEmpty(data.Strings["com.google.firebase.crashlytics.mapping_file_id"])) {
                            stateText = "redText";
                            state = "缺失1";
                        }
                    }


                    autoHtml += "  <li class=\"resultli\">\n" +
                        "                <span class=\"resultliname\">" + v.name + "</span><span class=\"resultlistate " + stateText + "\">" + state + "</span>\n" +
                        "            </li>";


                });
                $(".keepLibUl").html(autoHtml);

            }

            if (data.domainName) {
                var autoHtml = "";
                data.domainName.forEach(function (v, i) {

                    var state = "";
                    var stateText = "";
                    if (1 == v.state) {
                        state = "";
                    } else if (-1 == v.state) {
                        stateText = "redText";
                        state = "问题域名";
                    }
                    // stateText = "redText";
                    autoHtml += "  <li class=\"resultli\">\n" +
                        "                <span class=\"resultliname\">" + v.name + "</span><span class=\"resultlistate " + stateText + "\">" + state + "</span>\n" +
                        "            </li>";
                });
                $(".domainNameUl").html(autoHtml);

            }

            if (data.searchLogs) {
                var autoHtml = "";
                data.searchLogs.forEach(function (v, i) {

                    var state = "";
                    var stateText = "";
                    if (1 == v.state) {
                        state = "";
                    } else if (-1 == v.state) {
                        stateText = "redText";
                        state = "问题字符";
                    }
                    stateText = "redText";
                    state = "问题字符";
                    // stateText = "redText";
                    autoHtml += "  <li class=\"resultli\">\n" +
                        "                <span class=\"resultliname\">" + v.name + "</span><span class=\"resultlistate " + stateText + "\">" + state + "</span>\n" +
                        "            </li>";
                });
                $(".searchResultUl").html(autoHtml);

            }


            if (data.methodSolr) {
                var autoHtml = "";
                data.methodSolr.forEach(function (v, i) {

                    var state = "";
                    var stateText = "";
                    if (1 == v.state) {
                        state = "";
                    } else if (-1 == v.state) {
                        stateText = "redText";
                        state = "可疑方法";
                    }
                    // stateText = "redText";
                    autoHtml += "  <li class=\"resultli methodLine\">\n" +
                        "                <span class=\"resultliname\">" + v.name + "--->:&nbsp;" + v.content + "</span><span class=\"resultlistate " + stateText + "\">" + state + "</span>\n" +
                        "            </li>";
                });
                $(".methodLibUl").html(autoHtml);

            }

            if (data.fileCert) {
                var autoHtml = "";
                var v = data.fileCert;
                var state = "";
                var stateText = "";
                if (1 == v.state) {
                    state = "已签名";
                    v.name = "";
                } else if (-1 == v.state) {
                    stateText = "redText";
                    state = "未签名";
                }
                // stateText = "redText";
                autoHtml += "  <li class=\"resultli\">\n" +
                    "                <span class=\"resultliname\">" + v.name + "</span><span class=\"resultlistate " + stateText + "\">" + state + "</span>\n" +
                    "            </li>";

                $(".fileCertUl").html(autoHtml);

            }

        }

        function restResultAllView() {
            setRest(".BranchKey");
            setRest(".TestMode");
            setRest(".ApplicationId");
            setRest(".AutoLogAppEventsEnabled");
            setRest(".AdvertiserIDCollectionEnabled");
            setRest(".ClientToken");
            $(".searchResultFiled").html("");
            $(".searchResultPath").html("");
        }

        function setRest(e) {
            $(e).addClass("redText");
            $(e).html("缺失");
        }

        $(".imgClickIt").click(function () {
            $(".fileInput").click();
        });

        $(".iffsubmit").click(function () {
            // $("#uploadForm").submit();
            uploadImage();
        });


    })();
</script>

<script type="text/javascript" src="build.js"></script>

</body>
</html>