<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <title>Ios占坑</title>
    <script type="text/javascript" src="jquery.min.js"></script>
    <script type="text/javascript" src="utils.js"></script>

    <script>
        (function () {
            document.addEventListener('DOMContentLoaded', function () {
                var html = document.documentElement;
                var windowWidth = html.clientWidth;
                html.style.fontSize = windowWidth / 7.5 + 'px';
                // 等价于html.style.fontSize = windowWidth / 640 * 100 + 'px';
            }, false);
        })();
    </script>
    <style>

        ul li {
            list-style: none;
        }

        .greenText {
            color: green;
        }

        .garyText {
            color: gray;
        }

        .redText {
            color: red;
        }

        .pageCenter {
            background: white;
            font-size: 0.2rem;
        }

        .fileInput {
            display: none;
        }

        .appFileNameView {
            display: none;
        }

        .iffsubmitContainer {
            margin-top: 0.2rem;
        }

        .requestView {
            text-align: center;
        }

        .iffsubmit {
            background: #f40;
            border-radius: 0.3rem;
            padding: 0.1rem 1rem;
            color: white;
        }

        .resultContainer {
            padding: 0.1rem;
            font-size: 0.1rem;

        }

        .resultTitle {
            font-size: 0.2rem;
            color: black;
        }

        .resultlistate {
            margin-left: 0.3rem;
            font-weight: bold;

        }

        .resultUl {

        }

        .resultli {
        }

        .spiritContainer {
            width: 200px;
            height: 40px;
            border: deepskyblue solid 1px;
            border-radius: 10px;
            background-color: deepskyblue;
            color: white;
            position: absolute;
            top: 20px;
            overflow: hidden;
            right: 10px;
            line-height: 40px;
            font-size: 20px;
            text-align: center;
        }

        .spiritContainer:hover {
            background-color: #f40;
            border: #f40 solid 1px;
            height: auto;
            overflow: hidden;

        }

        .spiritContainer a {
            color: white;
        }


        .appAlert {
            border: orange dashed 5px;
            border-radius: 10px;
            background-color: white;
            color: grey;
            font-size: 22px;
        }

        .methodLine {
            border: #808080 solid 1px;
            margin-top: 10px;

        }

        .inxloading {
            width: 100px;
            height: 100px;
        }


        .resultUl {

        }

        .resultli {
            margin: 0;
            font-size: 10px;
            display: flex;
            align-items: center;
        }

        .resultliname {
            margin-right: 0.1rem;
            color: #808080;
        }

        .resultlivalue {
            color: black;
            font-weight: bold;
            font-style: italic;
        }

        .resultlistate {
            font-weight: bold;
            font-size: 10px;
            margin-left: 10px;
        }

        .reportItem {
            border: #ccc solid 3px;
            border-radius: 10px;
            margin-top: 10px;
            padding: 10px;
        }

        .imgExtendFlag {
            width: 20px;
            height: 20px;
        }

    </style>
</head>
<body>
<div class="pageCenter">


    <div class="spiritContainer">
        <span class="spirit">菜单</span>
        <ul class="menuList">
            <!--            <li><a href="/index">apk,aab业务包</a></li>-->
            <!--            <li><a href="/nbjson">检测大json</a></li>-->
            <!--            <li><a href="/debug1">检测占坑包</a></li>-->
        </ul>
    </div>
    <div class="requestView">
        <div>
            <span>点击上传:占坑包Ipa</span>
        </div>
        <img class="imgClickIt" src="dianji.png">
        <form id="uploadForm" action="/uploadImage" method="POST" enctype="multipart/form-data">
            <input class="fileInput" id="inputFile" type="file" NAME="file">
            <div class="appFileNameView">
                <span>文件名称:</span><span class="appFileName"></span>
            </div>


            <div class="iffsubmitContainer">
            <span class="iffsubmit">
                占坑包上传
            </span>
            </div>
        </form>
    </div>


    <div class="resultContainer">

        <div class="reportItem">
            <div class="resultTitle configInfoTitle">
                <span class="pName">configInfo</span><span class="listSize"></span><span class="pMessage"></span><img
                    class="imgExtendFlag"
                    src="arrow_right.png">
            </div>
            <ul class="resultUl configInfo">
            </ul>
        </div>

        <div class="reportItem">
            <div class="resultTitle permissionTitle">
                <span class="pName">permission</span><span class="listSize"></span><span class="pMessage"></span><img
                    class="imgExtendFlag"
                    src="arrow_right.png">
            </div>
            <ul class="resultUl permission">
            </ul>
        </div>

        <div class="resultTitle">
            域名检测
        </div>
        <ul class="domainNameUl">
            <!--            <li class="resultli">-->
            <!--                <span class="resultliname">scheme</span><span class="resultlistate scheme"></span>-->
            <!--            </li>-->
        </ul>
        <div class="resultTitle">
            库检测
        </div>
        <ul class="keepLibUl">
            <!--            <li class="resultli">-->
            <!--                <span class="resultliname">scheme</span><span class="resultlistate scheme"></span>-->
            <!--            </li>-->
        </ul>

        <div class="resultTitle">
            方法检测
        </div>
        <ul class="methodLibUl">
            <!--            <li class="resultli">-->
            <!--                <span class="resultliname">scheme</span><span class="resultlistate scheme"></span>-->
            <!--            </li>-->
        </ul>

        <div class="resultTitle">
            <div>字符串关联检测 <span class="appAlert" style="padding: 10px">（注意：已提交单产品业务包的不必考虑此项）</span></div>
        </div>
        <ul class="searchResultUl">
            <!--            <li class="resultli">-->
            <!--                <span class="resultliname">scheme</span><span class="resultlistate scheme"></span>-->
            <!--            </li>-->
        </ul>
        <ul class="searchResultJson">
        </ul>

        <div class="resultTitle">
            <div>接口字段字符串关联检测 <span class="appAlert" style="padding: 10px">（注意：已提交单产品业务包的不必考虑此项）</span></div>
        </div>
        <ul class="searchResultFiled">
        </ul>
        <div class="resultTitle">
            <div>接口名称字符串关联检测 <span class="appAlert" style="padding: 10px">（注意：已提交单产品业务包的不必考虑此项）</span></div>
        </div>
        <ul class="searchResultPath">
        </ul>

    </div>

</div>

<script>
    (function () {
        console.log($);

        init();

        function init() {
            if (window.timerAp) {
                clearInterval(window.timerAp);
                window.timerAp = null;
            }
            window.timerAp = setInterval(function () {
                try {
                    var list = ['solid', 'dashed', "dotted", "double"];
                    var index = Math.floor(Math.random() * list.length);
                    $(".appAlert").css("borderStyle", list[index]);
                } catch (e) {
                }
            }, 1000)

        }


        console.log("=================getIP==========>");

        // getIP()


        function hideResult() {
            $(".resultContainer").css("display", 'none');
        }

        function showResult() {
            restResultAllView();
            $(".resultContainer").css("display", 'block');
        }

        hideResult();
        const $file = $('#inputFile');
        console.log($file);
        $file.on("change", function () { // 文件选择事件
            const filename = $file.val();
            console.log(filename);
            $(".appFileNameView").css("display", 'block');
            hideResult();
            $(".appFileName").html(filename);
        });
        restResultAllView();

        function uploadImage() {
            // 校验字段省略
            // 使用 ajax 上传文件，需要用 FormData 对象
            console.log($file[0].files[0]);
            var value = $file[0].files[0];
            if (value) {

            } else {
                showToast("请选择文件")
                return;
            }
            var formData = new FormData();
            formData.append("file", $file[0].files[0]); // 要上传的文件
            formData.append("appType", "4");
            showLoading();
            hideResult();
            $.ajax({
                url: "/uploadImage",
                type: "post",
                data: formData,
                timeout: 1000 * 120,
                contentType: false,
                processData: false,
                dataType: "text",
                success: function (data) {
                    dismissLoading();

                    var res = eval('(' + data + ')');
                    parseResult(res);
                    searchTaskFiled(res);
                    searchTaskPath(res);
                    searchTaskJson(res);
                },
                error: function (err) {
                    $(".appFileNameView").css("display", 'none');
                    dismissLoading();
                    console.error(err);
                }
            });
        }

        function searchTaskPath(e) {
            var savePos = e.data.savePos;

            if (isEmpty(savePos)) {
                return;
            }
            console.log("---------searchTaskPath---start----");

            var formData = new FormData();
            formData.append("savePos", e.data.savePos);
            $.ajax({
                url: "/searchTaskPath",
                type: "post",
                data: formData,
                timeout: 1000 * 120,
                contentType: false,
                processData: false,
                dataType: "text",
                success: function (data) {
                    console.log("---------searchTaskPath---result----");
                    var res = eval('(' + data + ')');
                    console.log(res);

                    var dataRes = res.data;
                    var autoHtml = "";
                    dataRes.searchPath.forEach(function (v, i) {

                        var state = "";
                        var stateText = "";
                        if (1 == v.state) {
                            state = "";
                        } else if (-1 == v.state) {
                            stateText = "redText";
                            state = "问题字符";
                        }
                        stateText = "redText";
                        state = "问题字符";
                        autoHtml += "  <li class=\"resultli\">\n" +
                            "                <span class=\"resultliname\">" + v.name + "</span><span class=\"resultlistate " + stateText + "\">" + state + "</span>\n" +
                            "            </li>";
                    });
                    $(".searchResultPath").html(autoHtml);
                },
                error: function (err) {
                    console.error(err);
                }
            });
        }


        function searchTaskJson(e) {
            var savePos = e.data.savePos;
            if (isEmpty(savePos)) {
                return;
            }
            var formData = new FormData();
            formData.append("savePos", e.data.savePos);
            $.ajax({
                url: "/searchTaskJson",
                type: "post",
                data: formData,
                timeout: 1000 * 120,
                contentType: false,
                processData: false,
                dataType: "text",
                success: function (data) {

                    console.log("---------searchTaskJson-------");
                    var res = eval('(' + data + ')');
                    console.log(res);

                    var dataRes = res.data;
                    var autoHtml = "";
                    dataRes.searchJson.forEach(function (v, i) {
                        var state = "";
                        var stateText = "";
                        if (1 == v.state) {
                            state = "";
                        } else if (-1 == v.state) {
                            stateText = "redText";
                            state = "问题字符";
                        }
                        stateText = "redText";
                        state = "问题字符";
                        // stateText = "redText";
                        autoHtml += "  <li class=\"resultli\">\n" +
                            "                <span class=\"resultliname\">" + v.name + "</span><span class=\"resultlistate " + stateText + "\">" + state + "</span>\n" +
                            "            </li>";
                    });
                    $(".searchResultJson").html(autoHtml);

                },
                error: function (err) {

                    console.error(err);
                }
            });
        }

        function searchTaskFiled(e) {
            var savePos = e.data.savePos;

            if (isEmpty(savePos)) {
                return;
            }
            console.log("====searchTaskFiled== start======");
            var formData = new FormData();
            formData.append("savePos", e.data.savePos);
            $.ajax({
                url: "/searchTaskFiled",
                type: "post",
                data: formData,
                timeout: 1000 * 120,
                contentType: false,
                processData: false,
                dataType: "text",
                success: function (data) {
                    console.log("---------searchTaskFiled---result----");

                    var res = eval('(' + data + ')');
                    console.log(res);


                    var dataRes = res.data;
                    var autoHtml = "";
                    dataRes.searchField.forEach(function (v, i) {

                        var state = "";
                        var stateText = "";
                        if (1 == v.state) {
                            state = "";
                        } else if (-1 == v.state) {
                            stateText = "redText";
                            state = "问题字符";
                        }
                        stateText = "redText";
                        state = "问题字符";
                        // stateText = "redText";
                        autoHtml += "  <li class=\"resultli\">\n" +
                            "                <span class=\"resultliname\">" + v.name + "</span><span class=\"resultlistate " + stateText + "\">" + state + "</span>\n" +
                            "            </li>";
                    });
                    $(".searchResultFiled").html(autoHtml);

                },
                error: function (err) {

                    console.error(err);
                }
            });
        }

        function parseResult(res) {
            console.log(res);
            var data = res.data;
            showResult();


            if (data.domainName) {
                var autoHtml = "";
                data.domainName.forEach(function (v, i) {

                    var state = "";
                    var stateText = "";
                    if (1 == v.state) {
                        state = "";
                    } else if (-1 == v.state) {
                        stateText = "redText";
                        state = "问题域名";
                    }
                    // stateText = "redText";
                    autoHtml += "  <li class=\"resultli\">\n" +
                        "                <span class=\"resultliname\">" + v.name + "</span><span class=\"resultlistate " + stateText + "\">" + state + "</span>\n" +
                        "            </li>";
                });
                $(".domainNameUl").html(autoHtml);

            }


            if (data.searchLogs) {
                var autoHtml = "";
                data.searchLogs.forEach(function (v, i) {

                    var state = "";
                    var stateText = "";
                    if (1 == v.state) {
                        state = "";
                    } else if (-1 == v.state) {
                        stateText = "redText";
                        state = "问题字符";
                    }
                    stateText = "redText";
                    state = "问题字符";
                    // stateText = "redText";
                    autoHtml += "  <li class=\"resultli\">\n" +
                        "                <span class=\"resultliname\">" + v.name + "</span><span class=\"resultlistate " + stateText + "\">" + state + "</span>\n" +
                        "            </li>";
                });
                $(".searchResultUl").html(autoHtml);

            }

            if (data.configInfo) {
                var configInfo = data.configInfo;
                var value = configInfo.value.value;
                var htmlString = "";
                for (const key in value) {
                    htmlString += createItem(value[key]);
                }
                $(".configInfo").html(htmlString);

                var isSuccess = 1;
                var message = "";

                if (isSuccess == 0) {
                    // message = "数据异常";
                    addRed(".configInfoTitle .pMessage");
                } else {
                    // message = "数据正常";
                    addGreen(".configInfoTitle .pMessage");
                }
                $(".configInfoTitle .pMessage").html(message)
            }

            if (data.permission) {
                var permission = data.permission;
                var value = permission.value.value;
                var htmlString = "";
                for (const key in value) {
                    htmlString += createPerItem(value[key]);
                }
                $(".permission").html(htmlString);

                var isSuccess = 1;
                var message = "";
                if (permission.state == 0) {
                    message = "没有 hardware数据";
                    isSuccess = 0;
                } else {
                    if (permission.value.state == 0) {
                        message += permission.value.msg
                        isSuccess = 0;
                    }
                }
                if (isSuccess == 0) {
                    // message = "数据异常";
                    addRed(".permissionTitle .pMessage");
                } else {
                    // message = "数据正常";
                    addGreen(".permissionTitle .pMessage");
                }
                $(".permissionTitle .pMessage").html(message)
            }
            // $(".resultTitle").unbind();
            $(".resultTitle").click(function (e) {
                console.log(e);
                console.log("-------");
                // console.log($(this).siblings(".resultUl"))
                // $(this).siblings(".resultUl").toggle();
            });

        }

        function addRed(e) {
            $(e).removeClass("greenText");
            $(e).addClass("redText");
        }

        function addGreen(e) {
            $(e).removeClass("redText");
            $(e).addClass("greenText");
        }


        function restResultAllView() {
            setRest(".BranchKey");
            setRest(".TestMode");
            setRest(".ApplicationId");
            setRest(".AutoLogAppEventsEnabled");
            setRest(".AdvertiserIDCollectionEnabled");
            setRest(".ClientToken");
            $(".isDebugUl").html("");
            $(".searchResultUl").html(getLoadingViews());
            $(".searchResultFiled").html(getLoadingViews());
            $(".searchResultPath").html(getLoadingViews());
            $(".searchResultJson").html(getLoadingViews());
        }

        function getLoadingViews() {
            return " <div class=\"inxloading_p\">\n" +
                "                <img class=\"inxloading\" src=\"loading.gif\">\n" +
                "            </div>";
        }


        function setRest(e) {
            $(e).addClass("redText");
            $(e).html("缺失");
        }

        $(".imgClickIt").click(function () {
            $(".fileInput").click();
        });

        $(".iffsubmit").click(function () {
            // $("#uploadForm").submit();
            uploadImage();
        });


        function createItem(e) {

            var state = "";
            var stateText = "greenText";

            if (0 == e.state) {
                state = "error";
                stateText = "redText";
            } else if (1 == e.state) {
                stateText = "greenText";
                state = "ok";
            }

            var value = e.value;

            var result = " <li class=\"resultli\">\n" +
                "                    <span class=\"resultliname\">" + e.name + "</span><span class=\"resultlivalue\">" + value + "</span><span class=\"resultlistate  " + stateText + "\">" + state + "</span>\n" +
                "                </li>";
            return result;
        }


        function createPerItem(e) {
            var state = "";
            var stateText = "greenText";
            if (0 == e.state) {
                state = "缺失";
                stateText = "redText";
            } else if (1 == e.state) {
                stateText = "greenText";

                state = "已配置";
            } else if (2 == e.state) {
                stateText = "garyText";
                state = "范围外";
            } else if (3 == e.state) {
                stateText = "redText";
                state = "严禁配置";
            }


            var value = e.value;

            var result = " <li class=\"resultli\">\n" +
                "                    <span class=\"resultliname\">" + e.name + "</span><span class=\"resultlivalue\">" + value + "</span><span class=\"resultlistate  " + stateText + "\">" + state + "</span>\n" +
                "                </li>";
            return result;
        }

        function createLUItem(e) {

            // console.log(e);

            var htmlString = "";
            var value = e.value;
            for (const key in value) {
                htmlString += createItem(value[key]);
            }

            var state = "";
            var stateText = "greenText";
            if (0 == e.state) {
                state = "error";
                stateText = "redText";
            } else if (1 == e.state) {
                stateText = "greenText";
                state = "ok";
            }
            var pname = e.name;
            var result = "  <div class=\"itemConLeng\">\n" +
                "                        <div class=\"titleItemDiv\">\n" +
                "                            <li class=\"resultli\">\n" +
                "                                <span class=\"resultliname\">" + pname + "</span><span\n" +
                "                                    class=\"resultlivalue\">--</span><span\n" +
                "                                    class=\"resultlistate " + stateText + "\">" + state + "</span><img class=\"imgExtendFlag\" src=\"arrow_right.png\">\n" +
                "                            </li>\n" +
                "                        </div>\n" +
                "                        <ul class=\"itemChildDiv\">\n" +
                htmlString +
                "                        </ul>\n" +
                "                    </div>";


            return result;
        }

    })();
</script>

<script type="text/javascript" src="build.js"></script>

</body>
</html>